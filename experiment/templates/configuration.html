{% extends 'layout.html' %}

{% block content %}
    {% if exp.state == "failed" %}

        <label id="msg" style="color:red;font-size:12pt;"> Error: {{ exp.error }}</label>

    {% endif %}
    <div class="configuration">
        <h1 align="center">New Run:</h1>
        <br>
        Run title: {{ exp.run_name }}
        <br>
        Detected subspaces: {{ columns|length }}


        <table class="table table-bordered" align="center" border="1" id="table_subspace"
               data-pagination="true"
               data-side-pagination="client"
               data-page-size="10">
            <tbody>

            {% for column in columns %}
                <tr>
                    <td>{{ column }}</td>
                    <td>{{ forloop.counter }}</td>
                </tr>
            {% endfor %}

            <br>
        </table>
        <br>


        <form id="formAdd" method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <br>
            <div class="operation">
                <fieldset>
                    <legend>Select Subspaces</legend>

                    {% for radio in form.operation_model_options %}
                        <label for="{{ radio.id_for_label }}">
                                                <span class="radio">
                                                    {{ radio.tag }}
                                                </span>
                            &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                            &nbsp
                            {{ radio.choice_label }}
                        </label>
                    {% endfor %}


                </fieldset>

                <div class="form-group" id="except" style="display: none">
                    <label> All subspaces, except: </label> <br>
                    {{ form.operation_except }}
                    <small>{{ form.operation_except.help_text }}</small>
                    <span style="color: red;">{{ form.operation_except.errors.0 }}</span>
                </div>

                <div class="form-group" id="combo" style="display: none">
                    <label> Combination: </label> <br>
                    {{ form.operation_written }}
                    <small>{{ form.operation_written.help_text }}</small>
                    <span style="color: red;">{{ form.operation_written.errors.0 }}</span>
                </div>
            </div>
            <br>
            <br>
            <br>

            <fieldset>
                <legend>If use ground truth file</legend>
                {% for radio in form.ground_truth_options %}
                    <label for="{{ radio.id_for_label }}">
                        <span class="radio">{{ radio.tag }}</span>
                        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                        &nbsp
                        {{ radio.choice_label }}
                    </label>
                {% endfor %}
            </fieldset>


            <button id="ground_truth_file" style="display: none">
                <label>{{ form.ground_truth.label }}: </label>
                {{ form.ground_truth }}
                <span style="color: red;">{{ field.errors.0 }}</span>
            </button>
            <br>
            <br>
            <br>


            <div>
                <h3>Run again with additional data:<input type="checkbox" onclick="showAdd(this)"></h3>

                <button id="addtional" style="display: none">
                    <label>{{ form.generated_file.label }}: </label>
                    {{ form.generated_file }}
                    <span style="color: red;">{{ field.errors.0 }}</span>
                </button>
                <br>
            </div>
            <br>
            <br>
            <br>


            Select Outlier Detection Method and input parameters:
            <label>
                <select name="odms" id="odms" onchange="displaySelected(this)">
                    {% for key in odms %}
                        <option value="{{ forloop.counter }}" {% if forloop.first %}selected{% endif %}> {{ key }}
                    {% endfor %}
                </select>
            </label>


            {% for key, para in odms.items %}
                <div id="odm{{ forloop.counter }}"
                     {% if forloop.first %}style="display: block"
                     {% else %}style="display: none"
                     {% endif %}>
                    <table class="table table-bordered" align="center" border="1" id="table_page{{ forloop.counter }}"
                           data-pagination="true"
                           data-side-pagination="client"
                           data-page-size="3">

                        <tbody id="parameters">
                        <div>
                            {% for name, default in para.items %}
                                <tr>
                                    <td>{{ name }}</td>
                                    <td><input type="text" placeholder="{{ default }}" name="{{ key }}_{{ name }}"></td>
                                </tr>
                            {% endfor %}
                        </div>
                        </tbody>
                    </table>
                </div>
            {% endfor %}

            <div>
                <br>
                <a href="/main/" style="margin-right: 500px">
                    <button type="button" value="cancel">Cancel</button>
                </a>

                <button id="btnSave" type="submit" value="Add run to queue">Add run to queue</button>
            </div>
        </form>

    </div>


{% endblock %}

{% block js %}




    <script>
        $(document).ready(function () {
                $('#table_subspace').bootstrapTable({
                    columns: [
                        {
                            field: 'Subspaces on *.csv',
                            title: "Subspaces on *.csv"
                        }, {
                            field: "Indexing",
                            title: "Indexing"
                        },]
                })
        })


        $(document).ready(function () {
            {% for key, para in odms.items %}
                $('#table_page{{ forloop.counter }}').bootstrapTable({
                    columns: [
                        {
                            field: 'parameters',
                            title: "parameters"
                        }, {
                            field: "value",
                            title: "value"
                        },]
                })
            {% endfor %}
        })

        function showSubspace() {
            var operation_model1 = $("#operation_model_1:checked").val()
            var operation_model2 = $("#operation_model_2:checked").val()

            if (operation_model1 === "2") {
                var exc = document.getElementById("except")
                exc.style.display = 'block'

            } else if (operation_model2 === "3") {
                var combo = document.getElementById("combo")
                combo.style.display = 'block'
            }


        }

        window.onload = showSubspace;

        $('#operation_model_0').change(function () {
            var select = $(this);
            var exc = $('#except');
            var combo = $('#combo');
            exc.hide();
            combo.hide();
        });

        $('#operation_model_1').change(function () {
            var select = $(this);
            var exc = $('#except');
            var combo = $('#combo');
            exc.show();
            combo.hide();
        });

        $('#operation_model_2').change(function () {
            var select = $(this);
            var exc = $('#except');
            var combo = $('#combo');
            exc.hide();
            combo.show();
        });

        $('#ground_truth_0').click(function () {
            var select = $(this);
            var gt = $('#ground_truth_file');
            gt.hide();
        });

        $('#ground_truth_1').click(function () {
            var select = $(this);
            var gt = $('#ground_truth_file');
            gt.show();
        });

        function showGT() {
            var up = document.getElementById("ground_truth_file")
            up.style.display = 'block';
        }

        function hideGT() {
            var up = document.getElementById("ground_truth_file")
            up.style.display = 'none';
        }

        function showAdd(obj) {
            var up = document.getElementById("addtional")
            if (obj.checked === true) {
                up.style.display = 'block';
            } else up.style.display = 'none'

        }


        function displaySelected() {
            var opt = $("#odms").val();
            document.getElementById("odm" + 1).style.display = 'none'
            document.getElementById("odm" + 2).style.display = 'none'
            document.getElementById("odm" + 3).style.display = 'none'
            document.getElementById("odm" + 4).style.display = 'none'
            document.getElementById("odm" + 5).style.display = 'none'
            document.getElementById("odm" + 6).style.display = 'none'
            document.getElementById("odm" + 7).style.display = 'none'
            document.getElementById("odm" + 8).style.display = 'none'
            document.getElementById("odm" + 9).style.display = 'none'
            document.getElementById("odm" + 10).style.display = 'none'
            document.getElementById("odm" + 11).style.display = 'none'
            document.getElementById("odm" + 12).style.display = 'none'
            document.getElementById("odm" + 13).style.display = 'none'
            document.getElementById("odm" + 14).style.display = 'none'
            document.getElementById("odm" + 15).style.display = 'none'
            document.getElementById("odm" + 16).style.display = 'none'
            document.getElementById("odm" + 17).style.display = 'none'
            document.getElementById("odm" + 18).style.display = 'none'
            document.getElementById("odm" + 19).style.display = 'none'
            document.getElementById("odm" + 20).style.display = 'none'
            document.getElementById("odm" + 21).style.display = 'none'
            document.getElementById("odm" + 22).style.display = 'none'
            document.getElementById("odm" + 23).style.display = 'none'
            document.getElementById("odm" + 24).style.display = 'none'


            document.getElementById("odm" + opt).style.display = 'block'

        }
    </script>

{% endblock %}