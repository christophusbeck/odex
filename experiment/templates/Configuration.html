{% extends 'layout.html' %}

{% block content %}
    <div class="configuration">
        <h1 align="center">New Run:</h1>
        <br>
        Run title: {{ exp.run_name }}
        <br>
        Detected subspaces: {{ columns|length }}


        <table class="table table-bordered" align="center" border="1">
            <thead>
            <tr>
                <th>Subspaces on *.csv</th>
                <th>Indexing</th>
            </tr>
            </thead>
            <tbody>

            {% for column in columns %}
                <tr>
                    <td>{{ column }}</td>
                    <td>{{ forloop.counter }}</td>
                </tr>
            {% endfor %}

            <br>
        </table>
        <br>


        <form id="formAdd" method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <br>
            <div class="operation">

                {#            form way#}
                {#                {% for choice in form.operation_model_options %}#}
                {#                    <div class="form-group">#}
                {#                        <p>{{ choice }}</p>#}
                {#                    </div>#}
                {#                {% endfor %}#}
                <input type="radio" id="sub" name="sub" onclick="hideLogAndCombo()" value="all">
                <label>All subspaces:</label><br>
                <input type="radio" id="sub" name="sub" onclick="showExcept()" value="except">
                <label>All, except:</label><br>
                <input type="radio" id="sub" name="sub" onclick="showCombo()" value="combo">
                <label>Combination:</label>

                <div class="form-group" id="except" style="display: none">
                    <label> All subspaces, except: </label> <br>
                    {{ form.operation_except }}
                    <small>{{ form.operation_except.help_text }}</small>
                    <span style="color: red;">{{ form.operation_except.errors.0 }}</span>
                </div>

                <div class="form-group" id="combo" style="display: none">
                    <label> Combination: </label> <br>
                    {{ form.operation_written }}
                    <small>{{ form.operation_written.help_text }}</small>
                    <span style="color: red;">{{ form.operation_written.errors.0 }}</span>
                    {#                    form way#}
                    {#                    <label>{{ form.operation.label }}: </label>#}
                    {#                    {{ form.operation }}#}
                    {#                    <span style="color: red;">{{ field.errors.0 }}</span>#}
                </div>


            </div>
            {#            form way#}
            {#                {% for choice in form.ground_truth_options %}#}
            {#                    <div class="form-group">#}
            {#                    <p>{{ choice }}</p>#}
            {#                    </div>#}
            {#                {% endfor %}#}

            <div>
                <div><h3>If use ground truth file:</h3></div>
                <input type="radio" name="gt" onclick="hideGT()" value="False"> Detection only <br>
                <input type="radio" name="gt" onclick="showGT()" value="True"> Compare with a grund truth file
                <br>

                <button id="ground_truth_file" style="display: none">
                    <label>{{ form.ground_truth.label }}: </label>
                    {{ form.ground_truth }}
                    <span style="color: red;">{{ field.errors.0 }}</span>
                </button>
            </div>


            <div>
                {#            form way#}
                {#                <div> {{ form.additional_data_option }} <h3>Run again with additional data</h3></div>#}
                <h3>Run again with additional data:<input type="checkbox" onclick="showAdd(this)"></h3>

                <button id="addtional" style="display: none">
                    <label>{{ form.generated_file.label }}: </label>
                    {{ form.generated_file }}
                    <span style="color: red;">{{ field.errors.0 }}</span>
                </button>
                <br>
            </div>


            <br>
            Select Outlier Detection Method and input parameters:
            <label>
                <select name="odms" id="odms" onchange="test(this)">
                    {% for key in odms %}
                        <option value="{{ forloop.counter }}"> {{ key }}
                    {% endfor %}
                </select>
            </label>


            {% for key, para in odms.items %}
                <div style="display: none" id="odm{{ forloop.counter }}">
                <table class="table table-bordered" align="center" border="1" >
                    <thead>
                    <tr>
                        <th>parameters</th>
                        <th>values</th>
                    </tr>
                    </thead>

                    <tbody id="parameters" >
                    <div>
                        {% for name, default in para.items %}
                            <tr>
                                <td>{{ name }}</td>
                                <td><input type="text" placeholder="{{ default }}" name="{{ key }}_{{ name }}"></td>
                            </tr>
                        {% endfor %}
                    </div>
                    </tbody>
                </table>
                </div>
            {% endfor %}

            <div>
                <br>
                <a href="/main/" style="margin-right: 500px">
                    <button type="button" value="cancel">Cancel</button>
                </a>

                <button id="btnSave" type="submit" value="Add run to queue">Add run to queue</button>
            </div>
        </form>

    </div>


{% endblock %}

{#{% block js %}#}
{#    <script type="text/javascript">#}
{#        $(function () {#}
{#            bindBtnSaveEvent()#}
{#        })#}
{##}
{#        function bindBtnSaveEvent() {#}
{#            $("#btnSave").click(function () {#}
{#                var formData = new FormData($("#formAdd")[0])#}
{#                formData.append('exp_id' , {{ exp.id }})#}
{##}
{#                // 清除错误信息#}
{#                $(".error-msg").empty();#}
{##}
{#                $.ajax({#}
{#                    url: "/configuration/",//  -> /order/edit/?uid=12#}
{#                    type: "post",#}
{#                    data: {formData},//获取表单中用户填写的数据#}
{#                    processData: false,#}
{#                    contentType: false,#}
{#                    dataType: "JSON",#}
{#                    success: function (res) {#}
{#                        if (res.status) {#}
{#                            //location.reload()#}
{#                            window.location.href = "/main/";#}
{#                        } else {#}
{#                            // 把错误信息显示在对话框中。#}
{#                            $.each(res.error, function (name, errorList) {#}
{#                                $("#id_" + name).next().text(errorList[0]);#}
{#                            })#}
{#                        }#}
{#                    }#}
{#                })#}
{#            });#}
{#        }#}
{#    </script>#}
{#{% endblock %}#}